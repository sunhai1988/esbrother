<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css"
	href="../../themes/default/easyui.css" />
<link rel="stylesheet" type="text/css" href="../../themes/icon.css" />
<link rel="stylesheet" type="text/css" href="../../css/oaUtil.css" />
<link rel="stylesheet" type="text/css"
	href="../../css/lpsf_form_css.css" />
<script src="../../lib/jquery/jquery-1.3.2.min.js"
	type="text/javascript"></script>
<script src="../../lib/ligerUI/js/plugins/ligerTree.js"
	type="text/javascript"></script>
<script type="text/javascript" src="../../lhgdialog/lhgcore.min.js"></script>
<script type="text/javascript" src="../../lhgdialog/lhgdialog.min.js"></script>
<script type="text/javascript" src="../../js/oaUtil.js"></script>
<script type="text/javascript" src="../../js/dcdiv.js"></script>
<script src="../../js/vali/formValidator-4.1.1.js"
	type="text/javascript" charset="UTF-8"></script>
<script src="../../js/vali/formValidatorRegex.js" type="text/javascript"
	charset="UTF-8"></script>
<script type="text/javascript" src="../../js/jquery.easyui.min.js"></script>
<script type="text/javascript">
	var DG = frameElement.lhgDG;
	var manager = null;
	$(document).ready(function() {
		$('#cc').combogrid({
			panelWidth : 450,
			idField : 'name',
			textField : 'textone',
			url : 'comgrid.json',
			columns : [ [ {
				field : 'name',
				title : '样式',
				width : 80,
				formatter : function(value) {
					return formatString('<span class="{0}" style="display:inline-block;vertical-align:middle;width:16px;height:16px;"></span>', value);
				}
			}, {
				field : 'textone',
				title : '名称',
				width : 120
			}, {
				field : 'des',
				title : '描述',
				width : 200
			} ] ]
		});		
		$.formValidator.initConfig({
			onError : function(msg, obj, errorlist) {
			},
			submitAfterAjaxPrompt : '有数据正在异步验证，请稍等...',
			onShowClass : "",
			onFocusClass : "",
			onCorrectClass : ""
		});
		$("#masterplateName").formValidator({
			onShow : "请输入模版名称",
			onFocus : "至少1个长度",
			onCorrect : "输入合法"
		}).inputValidator({
			min : 1,
			empty : {
				leftEmpty : false,
				rightEmpty : false,
				emptyError : "两边不能有空符号"
			},
			onError : "不能为空,请确认"
		});
		$("#sd").formValidator({
			onShow : "请输入父模版编号",
			onFocus : "至少1个长度",
			onCorrect : "输入合法"
		}).inputValidator({
			min : 1,
			empty : {
				leftEmpty : false,
				rightEmpty : false,
				emptyError : "两边不能有空符号"
			},
			onError : "不能为空,请确认"
		});
		DG.addBtn('ok', '确定', add);
		queryByIdone('queryByIdMaster.action');		
		setTimeout("setCombogridValue()",100);
	});
	function setCombogridValue(){
		var icon = $("#icon").val();
		$('#cc').combogrid('setValue', icon);
	}
	function add() {
		var g = $('#cc').combogrid('grid');
		var r = g.datagrid('getSelected');
		if(r!=null){
			$("#icon").val(r.name);
		}	
		if ($.formValidator.pageIsValid("1")) {
			var params = $("#userForm").serializeArray();
			$.post("saveOrUpdateMaster.action",
					$("#userForm").serializeArray(), function(data) {
						DG.curWin.location.reload();
					});
			DG.curWin.location.reload();
		}
	}
	function openTree() {
		var blg = $("#issystemmaterplate").val();
		if (blg == "") {
			alert("请选择模板");
			return;
		}
		var testDG2 = new DG.curWin.$.dialog({
			id : 'child',
			title : '模版选择',
			cover : true,
			page : 'role/master/queryqxtree.html',
			width : '600',
			height : '600',
			parent : DG
		});
		testDG2.ShowDialog();

	}
	function change_s(ss) {
		$("#sd").val("");
	}
	function addNode(div_id) {
		var note = manager.getSelected();
		$("#sd").val(note.data.id)
		$("#mask").remove();
		$("#" + div_id).animate({
			left : 0,
			top : 0,
			opacity : "hide"
		}, "slow");
	}

	function getCompany() {
		var testDG2 = new DG.curWin.$.dialog({
			id : 'child',
			title : '模版选择',
			cover : true,
			page : 'role/master/getcompany.html',
			width : '500',
			height : '500',
			parent : DG
		});
		testDG2.ShowDialog();
	}
</script>
</head>

<body>
	<form id="userForm" name="validateForm1" method="post"
		style="margin: 10; text-align: center;">
		<table border="0" cellpadding="0" cellspacing="1" width="98%">
			<input type="hidden" jsn="id" name="lm.id" />
			<input type="hidden" jsn="rootId" name="lm.rootId" />
			<input type="hidden" id="icon" jsn="icon" name="lm.icon" />
			<tr>
				<td width="120">模版名称</td>
				<td><input type="text" id="masterplateName"
					jsn="masterplateName" name="lm.masterplateName"></input><a
					href="javascript:getCompany();">选择公司</a>
				</td>
				<td><div id="masterplateNameTip" style="width: 280px"></div>
				</td>
			</tr>
			<tr>
				<td>是否是系统模板</td>
				<td><select id="issystemmaterplate"
					name="lm.issystemmaterplate" jsn="issystemmaterplate"
					onchange="change_s(this.value);">
						<option value="">---请选择---</option>
						<option value="0">是</option>
						<option value="1">否</option>
				</select></td>
				<td><div id="issystemmaterplateTip" style="width: 280px"></div>
				</td>
			</tr>
			<tr>
				<td>排列次序</td>
				<td><input type="text" jsn="sort" name="lm.sort"></input>
				</td>
				<td></td>
			</tr>
			<tr>
				<td>简称</td>
				<td><input type="text" jsn="introduction"
					name="lm.introduction"></input>
				</td>
				<td></td>
			</tr>
			<tr>
				<td>父模板编号</td>
				<td><input type="text" id="sd" jsn="fathermasterplatecode"
					name="lm.fathermasterplatecode"></input><a
					href="javascript:void(0);" onclick="openTree();">添加</a>
				</td>
				<td><div id="sdTip" style="width: 280px"></div>
				</td>
			</tr>
			<tr>
				<td>是否是权限模版</td>
				<td colspan="2"><select jsn="islimitmasterplate"
					name="lm.islimitmasterplate">
						<option value="">---请选择---</option>
						<option value="0">是</option>
						<option value="1">否</option>
				</select>
				</td>
			</tr>
			<tr>
				<td>菜单图标</td>
				<td colspan="2"><select id="cc" style="width: 250px;"></select></td>
			</tr>
			<tr>
				<td>页面路径</td>
				<td colspan="2"><input type="text" jsn="pageurl"
					name="lm.pageurl" size="80"></input>
				</td>
			</tr>
			<tr>
				<td>模板首页</td>
				<td colspan="2"><input type="text" jsn="firstmasterplate"
					name="lm.firstmasterplate" size="80"></input>
				</td>
			</tr>
			<tr>
				<td>权限说明</td>
				<td colspan="2"><textarea jsn="limitdeclare"
						name="lm.limitdeclare" style="width: 95%;" rows="6"></textarea>
				</td>
			</tr>
		</table>
	</form>
	<div id='pop-div' style="width: 300px;" class="pop-box">
		<ul id="tt2"></ul>
	</div>
</body>
</html>
